<html>
<head>
<script type=text/javascript>
var wc = '0473';

var o;
var timestamp = new Date(2022,0,1);
var data = [];
  
function draw(){
  mydata = [], fcol = '#fff', bcol = '#222';
  for(var y=0; y<data.length; y++){
    if(data[y][0]==wc){mydata.push(data[y]);}
    }
  //timestamp = new Date(2022,8,12,16,16);
  //alert(timestamp);
  screenRatio=1080/1920;
  wmax = innerWidth-16; hmax = window.innerHeight-16;
  W = wmax; H= W * screenRatio;
  if(H>hmax){H=hmax;W=H/screenRatio;}
  r = W/1080;
  o.width=W; o.height=H;
  o.ctx.scale(0.5,0.5);
  W=W*2; H=H*2;
  with (o.ctx) {
    textBaseline = "middle";
    lineWidth = 6;
    strokeStyle='#eee';
    //strokeRect(0,0,W,H);

    font = (20*r).toString() + "px Arial";
    textAlign = "left";
    fillStyle = fcol;
    fillText("Production Control - " + timestamp.getFullYear().toString() + '-' + (timestamp.getMonth()+1).toString() + '-' + timestamp.getDate().toString() +
             ' ' + timestamp.getHours() + ':' + timestamp.getMinutes(), 0, H * 0.02)

    font = "bold " + (38*r).toString() + "px Arial";
    textAlign = "center";
    fillText("0473. EQUIPEMENT ETALONNAGE CONVENTIONNEL", W* .6, H * 0.03);

    lineWidth = 4;
    strokeStyle='#888';
    font = "bold " + (24*r).toString() + "px Arial";
    var ytbl;
    for(var y=0;y<27;y++){
      ytbl=y+1;
      if(y==0){
        fillStyle="#248";
        fillRect(.23*W ,.09*H + .032*H*y,.752*W,.032*H);
        fillStyle="#f5f5f5";
        textAlign = "center";
        fillText("Workorder", .261*W ,.108*H);
        textAlign = "left";
        fillText("Operation", .295*W ,.108*H);
        fillText("Description", .515*W ,.108*H);
        fillText("Std.H", .735*W ,.108*H);
        fillText("SO / Customer", .775*W ,.108*H);
        fillText("Aging", .945*W ,.108*H);
        }else{
        if(mydata[ytbl]){
          if(mydata[ytbl][1]==1){fcol='#f77';}else{fcol='#f5f5f5';}
          }
        fillStyle="#222";
        fillRect(.23*W ,.09*H + .032*H*y,.062*W,.032*H);
        fillStyle=fcol;
        textAlign = "center";
        font = (26*r).toString() + "px Arial";
        if(mydata[ytbl]){fillText(mydata[ytbl][3].toString(), .261*W ,.108*H + .032*H*y);}
        //fillText("00000000", .261*W ,.108*H + .032*H*y);
        fillStyle="#222";
        fillRect(.292*W ,.09*H + .032*H*y,.22*W,.032*H);
        fillStyle=fcol;
        textAlign = "left";
        if(mydata[ytbl]){fillText(mydata[ytbl][4], .295*W ,.108*H + .032*H*y);}
        fillStyle="#222";
        fillRect(.512*W ,.09*H + .032*H*y,.22*W,.032*H);
        fillStyle=fcol;
        if(mydata[ytbl]){fillText(mydata[ytbl][5], .515*W ,.108*H + .032*H*y);}
        fillStyle="#222";
        fillRect(.732*W ,.09*H + .032*H*y,.04*W,.032*H);
        fillStyle=fcol;
        textAlign = "right";
        if(mydata[ytbl]){fillText(mydata[ytbl][6].toString(), .769*W ,.108*H + .032*H*y);}
        fillStyle="#222";
        fillRect(.772*W ,.09*H + .032*H*y,.17*W,.032*H);
        fillStyle=fcol;
        textAlign = "left";
        if(mydata[ytbl]){fillText(mydata[ytbl][7], .775*W ,.108*H + .032*H*y);}
        fillStyle="#222";
        fillRect(.942*W ,.09*H + .032*H*y,.04*W,.032*H);
        if(mydata[ytbl]){
          if(mydata[ytbl][8]<6){
            fillStyle='#6f6';}
          else if(mydata[ytbl][8]<11){
            fillStyle='#6f6';}
          
          fillStyle=fcol;
          beginPath();
          arc(.962*W, .106*H + .032*H*y, .005*W, 0, 2 * Math.PI);
          fill();
          }
        fillStyle=fcol;
        fillRect(.217*W ,.096*H + .032*H*y,.01*W,.018*H);
        }
      strokeRect(.23*W ,.09*H + .032*H*y,.062*W,.032*H);
      strokeRect(.292*W ,.09*H + .032*H*y,.22*W,.032*H);
      strokeRect(.512*W ,.09*H + .032*H*y,.22*W,.032*H);
      strokeRect(.732*W ,.09*H + .032*H*y,.04*W,.032*H);
      strokeRect(.772*W ,.09*H + .032*H*y,.17*W,.032*H);
      strokeRect(.942*W ,.09*H + .032*H*y,.04*W,.032*H);
      }
    beginPath();
    moveTo(0,.09*H);
    lineTo(.21*W,.09*H);
    moveTo(0,.442*H);
    lineTo(.21*W,.442*H);
    stroke();
    }
  }

function loadData(){
    var d = new Date();
    var sd = d.getUTCFullYear() + '-' + (d.getUTCMonth() + 1) + '-' + d.getUTCDate() + ' ' +  d.getUTCHours() + ':' + d.getUTCMinutes() + ':' + d.getUTCSeconds();
    var js = document.createElement('script');
    js.type='text/javascript';
    js.src="vmwc.js" + "?d=" + sd;
    js.onload = draw;
    document.head.appendChild(js);    
    }    
    
window.onload=function(){
  document.title = wc;
  o=document.createElement('canvas');
  o.ctx=o.getContext('2d');
  loadData();
  draw();
  document.body.appendChild(o)
  }

window.onresize=function(){
  draw();
  }


setInterval(function() {
    loadData();
    draw();
}, 20000);


</script>
</head>
<body style="background-color:#222">


</body>
</html>
