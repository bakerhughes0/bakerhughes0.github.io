<html>
<head>
<script type=text/javascript src=js/func.js?v=001></script>
<script type=text/javascript src=js/canvasjs.min.js?v=007></script>
<script type=text/javascript src=module.js?v=003></script>
<script type=text/javascript>

function refreshall(){
  gfx0.render();gfx1.render();gfx2.render();gfx3.render();  }

function loadData(){
  var d = new Date();
  var sd = d.getUTCFullYear() + '-' + (d.getUTCMonth() + 1) + '-' + d.getUTCDate() + ' ' +  d.getUTCHours() + ':' + d.getUTCMinutes();
  var js = document.createElement('script');
  js.type='text/javascript';
  js.src="wipstg.js" + "?d=" + sd;
  document.head.appendChild(js);    
  js.onload = function(){ 
    for(var n=0;n<2;n++) {
      gfx0.options.data[n].dataPoints=[];
      gfx1.options.data[n].dataPoints=[];
      gfx2.options.data[n].dataPoints=[];
      gfx3.options.data[n].dataPoints=[];
      }
    for(var n=0;n<wipstages.C.length;n++){
      gfx0.options.data[0].dataPoints.push({label:wipstages.C[n][0].slice(4), y:wipstages.C[n][2]})
      gfx0.options.data[1].dataPoints.push({label:wipstages.C[n][0].slice(4), y:wipstages.C[n][1]-wipstages.C[n][2]})
      }
    for(var n=0;n<wipstages.G.length;n++){
      gfx1.options.data[0].dataPoints.push({label:wipstages.G[n][0].slice(4), y:wipstages.G[n][2]})
      gfx1.options.data[1].dataPoints.push({label:wipstages.G[n][0].slice(4), y:wipstages.G[n][1]-wipstages.G[n][2]})
      }
    for(var n=0;n<wipstages.V.length;n++){
      gfx2.options.data[0].dataPoints.push({label:wipstages.V[n][0].slice(4), y:wipstages.V[n][2]})
      gfx2.options.data[1].dataPoints.push({label:wipstages.V[n][0].slice(4), y:wipstages.V[n][1]-wipstages.V[n][2]})
      }
    for(var n=0;n<wipstages.L.length;n++){
      gfx3.options.data[0].dataPoints.push({label:wipstages.L[n][0].slice(4), y:wipstages.L[n][2]})
      gfx3.options.data[1].dataPoints.push({label:wipstages.L[n][0].slice(4), y:wipstages.L[n][1]-wipstages.L[n][2]})
      }
    refreshall();
    sTxt(timstp,'Update : ' + tm);
    }
  setTimeout(loadData, 60000);
  }

var g, tip;
window.onload=function(){
  var bg = new background();
  t1=new xLab();sFtC(t1,'#ccc');sPar(t1,0);
  t2=new xLab();sFtC(t2,'#ccc');sPar(t2,0);sFtA(t2,'right');
  sTxt(t1,"CONDE MATERIALS KPI - WIP STAGES");
  sTxt(t2,"");
  timstp=new xLab();sPar(timstp,main);sFtC(timstp,'#666');
  g = [];
  for(var n=0; n<4; n++){g[n] = new gfxbox();}
  var axeY_1 = {title: "Materials", titleFontColor: "#eee", labelFontColor: "#eee", labelFontFamily: 'Arial', minimum:0}
  var axeX_1 = {labelFontColor: "#eee", interval: 1, labelAngle: -30, labelFontFamily: 'Arial'}
  var leg_1 = {horizontalAlign: "center", verticalAlign: "bottom", labelFontFamily: 'Arial', fontColor: "#eee"}
  var ttip1 = {shared: true, backgroundColor: '#cdc', borderColor:'grey', content: toolTipContentX};
  gfx0 = new CanvasJS.Chart(g[0], {
  animationEnabled: true,
  animationDuration: 500,
  title: {text: "CAMFLEX", fontSize:18, fontColor:"#ddd",fontFamily: 'Arial'},
  backgroundColor: null,
  dataPointMaxWidth: 40,
  legend:leg_1,
  axisY:axeY_1,
  axisX:axeX_1,
  toolTip:ttip1,
  data: [              
    { mouseover: showtip, mouseout:hidetip, type: "stackedColumn", name: "Missing Parts", color: "#B44", dataPoints: [], showInLegend: true },
    { mouseover: showtip, mouseout:hidetip, type: "stackedColumn", name: "Products", color: "#8B8", dataPoints: [], showInLegend: true, indexLabel: "#total", indexLabelPlacement: "top", indexLabelFontColor: "#efe" },
    ]
  });
  gfx1 = new CanvasJS.Chart(g[1], {
  animationEnabled: true,
  animationDuration: 500,
  title: {text: "GLOBES", fontSize:18, fontColor:"#ddd",fontFamily: 'Arial'},
  backgroundColor: null,
  dataPointMaxWidth: 40,
  legend:leg_1,
  axisY:axeY_1,
  axisX:axeX_1,
  toolTip:ttip1,
  data: [              
    { mouseover: showtip, mouseout:hidetip, type: "stackedColumn", name: "Missing Parts", color: "#B44", dataPoints: [], showInLegend: true },
    { mouseover: showtip, mouseout:hidetip, type: "stackedColumn", name: "Products", color: "#8B8", dataPoints: [], showInLegend: true, indexLabel: "#total", indexLabelPlacement: "top", indexLabelFontColor: "#efe" },
    ]
  });
  gfx2 = new CanvasJS.Chart(g[2], {
  animationEnabled: true,
  animationDuration: 500,
  title: {text: "VARIPAK", fontSize:18, fontColor:"#ddd",fontFamily: 'Arial'},
  backgroundColor: null,
  dataPointMaxWidth: 40,
  legend:leg_1,
  axisY:axeY_1,
  axisX:axeX_1,
  toolTip:ttip1,
  data: [              
    { mouseover: showtip, mouseout:hidetip, type: "stackedColumn", name: "Missing Parts", color: "#B44", dataPoints: [], showInLegend: true },
    { mouseover: showtip, mouseout:hidetip, type: "stackedColumn", name: "Products", color: "#8B8", dataPoints: [], showInLegend: true, indexLabel: "#total", indexLabelPlacement: "top", indexLabelFontColor: "#efe" },
    ]
  });
  gfx3 = new CanvasJS.Chart(g[3], {
  animationEnabled: true,
  animationDuration: 500,
  title: {text: "LEVELS", fontSize:18, fontColor:"#ddd",fontFamily: 'Arial'},
  backgroundColor: null,
  dataPointMaxWidth: 40,
  legend:leg_1,
  axisY:axeY_1,
  axisX:axeX_1,
  toolTip:ttip1,
  data: [              
    { mouseover: showtip, mouseout:hidetip, type: "stackedColumn", name: "Missing Parts", color: "#B44", dataPoints: [], showInLegend: true },
    { mouseover: showtip, mouseout:hidetip, type: "stackedColumn", name: "Products", color: "#8B8", dataPoints: [], showInLegend: true, indexLabel: "#total", indexLabelPlacement: "top", indexLabelFontColor: "#efe" },
    ]
  });

  tip = new xDiv();sBkC(tip,'#eee');sPar(tip,0);sBrR(tip,[5]);sTrx(tip, 'Opacity .3s');sOvf(tip,'hidden');hidetip2();
  tip.h = new xLab();sPar(tip.h,tip);;
  tip.t = new xTbl();sPar(tip.t, tip);
  tip.tim = 0;
  tip.onmouseenter=function(){
      clearTimeout(tip.tim);
      }
  tip.onmouseleave=function(){
     clearTimeout(tip.tim);
     tip.tim = setTimeout(hidetip2, 200);
      }
  var W = scrW()*.97;
  tip.t.fields = [['Customer',W*.25],['SO/Line',W*.1],['WO',W*.07],['Part Description',W*.25],['Current Operation',W*.2813:28 14/10/2025],['WC',W*.05]];
  tip.eRes = function(){
      [W, H] = gSiz(tip);
      move(tip.h,[5,5,W-5,20]);
      move(tip.t,[5,25,W-5,H-30]);
      }
  window.onresize=function(){
    movep(bg,[0,0,1,1]);
    movep(t1,[.01, .01, .98, .045]);
    movep(t2,[.01, .01, .98, .045]);
    movep(timstp,[.01, .97, 1, .03]);
    for(var n=0; n<4; n++){
      x = Math.floor(n/2);
      y = n % 2;
      movep(g[n],[.01+x*.495, .07+y*.45, .485, .43]);
      }
    refreshall();
    movep(tip,[.01,.07,.98,0]);
    };window.onresize();

  loadData();
  }

function fmtCur2(num) {
 var a=parseFloat(num).toFixed(0);
 return a.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1 ');
 }

function hidetip(){
    clearTimeout(tip.tim);
    tip.tim = setTimeout(hidetip2, 1200);
    }

function hidetip2(){
    sOpa(tip, 0);
    sSiz(tip, [gSiz(tip)[0],0]);
    }

function showtip(e){
    clearTimeout(tip.tim); 
    sOpa(tip, .95);
    var f=['',''];
    f[0]=e.chart.title.text.slice(0,1);
    if(f[0]=='G' || f[0]=='L'){
        movep(tip,[.01,.07,.98,.43]);
        }else{
        movep(tip,[.01,.52,.98,.43]);
        }
    f[1]=e.dataPoint.label;
    sTxt(tip.h,e.chart.title.text + ' - ' + f[1]);
    tip.t.clear()
    var y = 0;
    for(var n=0; n< wipstg[f[0]].length; n++){
        if(wipstg[f[0]][n][0].slice(4)==f[1]){
            tip.t.addRow();
            tip.t.body.rows[y].onmouseenter = null;
            tip.t.body.rows[y].onmouseleave = null;
            if(wipstg[f[0]][n][1]==1){ 
                sBkC(tip.t.body.rows[y], '#b33');
                sFtC(tip.t.body.rows[y], '#fff');
                }else{ 
                sBkC(tip.t.body.rows[y], '#eee'); 
                sFtC(tip.t.body.rows[y], '#000'); 
                }
            for(var x=0; x<6; x++){
                sTxt(tip.t.cells(y,x), wipstg[f[0]][n][x+2]);
                }
            y++;
            }
        }
    }


function toolTipContentX(e) {
  var str = "";
  var total = 0;
  var str2, str3;
  str = "<style>table, th, td {font-family:'fnt1'; font-size:90%; border:1px solid black; border-collapse:collapse; white-space:nowrap}</style>";
  for (var i = 0; i < e.entries.length; i++){
    var  str1 = " <span style= \"color:"+e.entries[i].dataSeries.color + "\"> "+e.entries[i].dataSeries.name+"</span>: <strong>"+fmtCur2(e.entries[i].dataPoint.y)+"</strong><br/>";
    if(e.entries[i].dataSeries.name!='Target' && e.entries[i].dataSeries.name!='Capacity'){ total += e.entries[i].dataPoint.y;}
    str = str.concat(str1);
    }
  str2 = "<span style = \"color:#050;\"><strong>"+(e.entries[0].dataPoint.label)+"</strong></span><br/>";
  total = Math.round(total * 100) / 100;
  str3 = "<span style = \"color:#050\">Total:</span><strong> "+fmtCur2(total)+"</strong><br/>";
  return (str2.concat(str)).concat(str3);
  } 

function xTbl() {
  var headheight = 25;
  var rowsheight = 25;
  var obj = new xDiv();
   sPos(obj,[50,50]);
   sSiz(obj,[320,240]);
   sOvf(obj,'hidden');
   sBrW(obj,[1]);
   sBrC(obj,['#ccc']);
   sFtN(obj,'14px/25px fnt1');

  obj.head = new xDiv();
  sBkL(obj.head,90,'#eee 10%, #bbb 70%');

  sPos(obj.head,[0,0]);
  sMoP(obj.head,'default');
  sNoS(obj.head);
  obj.head.field = [];
  obj.createFields=function(f) {
    for (var n=0; n<f.length; n++) {
      if (!obj.head.field[n]) {obj.head.field[n] = new xDiv()}; 
        var c=obj.head.field[n];
        sTxt(c,f[n][0]);
        sBrW(c,[1]);
        sPos(c,[(obj.head.field[n-1]?gPos(obj.head.field[n-1])[0]+gSiz(obj.head.field[n-1])[0]-gBrW(obj.head.field[n-1])[1]: 0),0]);
        sSiz(c,[f[n][1], headheight]);
        sBrC(c,['#aaa']);
        sFtN(c,'14px/25px fnt1');
        sFtA(c,'center');
        sTxS(c,1,1,2,'#ccc');
        sPar(c,obj.head);
        };
    sSiz(obj.head, [gPos(obj.head.field[f.length-1])[0] + gSiz(obj.head.field[f.length-1])[0] ,headheight]);
    sPar(obj.head,obj);
    for(var n=obj.head.field.length-1;n>f.length-1;n--) {
      gPar(obj.head.field[n]).removeChild(obj.head.field[n]);
      obj.head.field.pop();
      };
    };
  Object.defineProperty(obj, "fields", { 
    get: function () {return ''},
    set: function (s) {obj.createFields(s)}
    });
  obj.body = new xDiv(); 
   sPos(obj.body,[0,headheight]);
   sBkC(obj.body,'#f8f8f8');
   sOvf(obj.body,'auto');
   sPar(obj.body,obj);
  obj.body.onscroll = function() {sPos(obj.head,[-this.scrollLeft,0])};
  obj.body.rows = [];
  obj.clear=function(){
    for(var n=0; n<obj.body.rows.length;n++) {
        obj.body.removeChild(obj.body.rows[n]) };
    obj.body.rows = [];
    };
  function mentr() {this.style.backgroundColor='#ace';};
  function mleav() {this.style.backgroundColor = this.idx % 2 ? '#f5f5f5': '#eec';};
  obj.addRow = function() {
    var y=obj.body.rows.length;
    obj.body.rows[y] = new xDiv();
    sPos(obj.body.rows[y],[0,rowsheight * y]);
    sFtC(obj.body.rows[y],'#225');
    sBkC(obj.body.rows[y],(y%2?'#f5f5f5':'#eec'));
    obj.body.rows[y].idx = y;
    obj.body.rows[y].onclick = function() {obj.rowclick(this.idx)};
    obj.body.rows[y].onmouseenter = mentr;
    obj.body.rows[y].onmouseleave = mleav;
    obj.body.rows[y].cells = [];
    var n=0;
    for (var n=0; n<obj.head.field.length;n++) {
      obj.body.rows[y].cells[n] = new xDiv(); 
      var c = obj.body.rows[y].cells[n];
       sBrW(c,[0,1,1,1]);
       sBrC(c,['#aaa']);
       sPad(c,[0,3]);sFtZ(c);sOvf(c,'hidden');
       sPos(c,[(obj.head.field[n-1]?gPos(obj.head.field[n-1])[0]+gSiz(obj.head.field[n-1])[0]-gBrW(obj.head.field[n-1])[1]: 0),0]);
       sSiz(c,[gSiz(obj.head.field[n])[0], rowsheight]);
       sPar(c,obj.body.rows[y]);
      };
    sSiz(obj.body.rows[y],[gSiz(obj.head)[0], rowsheight]);
    sPar(obj.body.rows[y],obj.body);
    }; 
  obj.cells = function(y,x) {return obj.body.rows[y].cells[x]};
  obj.eRes=function() {sSiz(obj.body,[gInS(obj)[0],gInS(obj)[1]-headheight]);};
  obj.eRes();
  obj.rowclick=function(idx){};
  return obj
  };

</script>
</head>
<body >
</body>
</html>
